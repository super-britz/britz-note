## PWA

Progressive Web Apps 是 Google 提出的用前沿的 Web 技术为网页提供 App 般使用体验的一系列方案。但是作为一个 web 应用，它可以断网使用、推送消息、发送通知、从桌面启动，当然还包括 Web 应用的优
势：免安装、快速开发、依赖浏览器跨平台( 持包括Edge在内的各种主流PC/ 机浏览 )。

Local Storage 过了 2.5M 会卡，可以扩容。

Web SQL 和 Index DB 是异步API，读取速度很慢。

Manifast 可能在用户那存一辈子。 

当然一般都是做列表页性质的 APP，地图那种实时任务就不行了。

#### 特点

- 响应式：用户界面可以兼容多种设备
- 应用化：交互体验接近 native 应用
- 网络低依赖：无网络或者低速网络下依然可以使用。
- 延续性：借助推送功能，能够维持用户粘性。不过推送有点坑，有些平台不支持。
- 可安装：可以被安装到主屏，这样用户随时可以从主屏启动应用 。
- 可被发现：被视为一个独立应用，且可以被搜索。（PWA应用一推， 微软和谷歌有这种平台，类似于应用宝那种）
- **可更新：当用户重新联网时，可以更新内容。**
- 安全：可以使用 HTTPS 来防止内容伪造和中间人攻击。HTTPS 并不是一定安全。 ngrok可以内网穿透
- 渐进性：所有用户都可以使用，与浏览器无关。（当然人家浏览器不支持JS API也不行）
- 兼容url：可以通过url传播。

#### 核心技术

- Service worker 是一个在浏览器后台运行的脚本，主要用于操作离线缓存。
- App Shell 就是一个壳，类似于骨架屏，在页面内容尚未加载完全的时候，优先展示页面的结构、占位图、主题和背景颜色等。（都是强缓存的html css js文件）

#### Service Worker

通过拦截网络请求，使得网站运行得更快，或者在离线情况下，依然可以执行。也作为其他后台功能的基础， 如消息推送和背景同步。

- 属于JavaScript Worker，不能直接接触DOM，通过 postMessage 接口与页面通信。
- 事件驱动，没有事件就不运行。
- 只在HTTPS 协议下可用，因为可以拦截网络请求，所以必须保证请求是安全的。
- 有一个精心定义的升级策略，内部大量使用 Promise。

**生命周期**

1. Installing 正在安装阶段：声明资源要被加入缓存。
2. Installed 安装完成阶段：我们可以在这个阶段告知用户，PWA 已经可以进行升级了。
3. Activating 正在激活阶段：Service Worker 脚本中的 activate() 事件会被执行，此时可以清除掉过期的资源。
4. Activated 激活完成阶段：Service Worker 内的 fetch 和 message 事件已经可以被监听，可以开始控制网站的资源请求。 
5. Redundant 废弃阶段：当安装失败，激活失败或者当前 Service Worker 被其他 Service Worker 替换，将失去对页面的控制。

#### workbox